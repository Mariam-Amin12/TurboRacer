;THE FUNCTIONALITY OF THIS CODE IS DRAWING THE CAR

collisionCOLOR EQU 14

PUBLIC CheckColisionCar1
PUBLIC CheckColisionCar2
EXTRN HEIGHT1:WORD
EXTRN WIDTH1:WORD
EXTRN CENTER1:WORD
EXTRN STATE1:BYTE
EXTRN EXPECTEDSTATE1:BYTE
EXTRN CANMOVE1:BYTE
EXTRN HEIGHT2:WORD
EXTRN WIDTH2:WORD
EXTRN CENTER2:WORD
EXTRN STATE2:BYTE
EXTRN EXPECTEDSTATE2:BYTE
EXTRN CANMOVE2:BYTE
.MODEL SMALL
.STACK 64
.CODE

CheckColisionCar1 PROC FAR
CMP EXPECTEDSTATE1 , 0      
JNZ RIGHT1
;PERFORM EQUATION CENTER-(WIDTH/2)-(320*HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (TOP LEFT IN THE SCREEN)
;CALCULATE (320*HEIGHT/2) TERM
MOV BX,320          
MOV AX,HEIGHT1
shr AX,1
INC AX
MUL BX
PUSH AX

;CALCULATE WIDTH/2 TERM
MOV AX , WIDTH1
shr AX,1

;GET THE REQUIRED POINT
MOV BX , CENTER1
SUB BX ,AX
POP AX
SUB BX,AX
MOV AX,BX

PUSH BX
MOV DX,HEIGHT1  
UPROW1:
MOV SI,AX
MOV CX,WIDTH1


LOOP11:
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVEUP1   ; ->THIS PIXEL HAS COLOUR OF THE OBSTACLE SO CAR CAN'T MOVE
INC SI
LOOP LOOP11
POP AX
ADD AX,320      ; MOVE TO THE NEXT ROW
PUSH AX
DEC DX          
CMP DX , 0
JNZ UPROW1
POP AX
MOV AL,1
MOV CANMOVE1,AL
JMP EXIT1

CANTMOVEUP1:
POP AX
MOV AL,0
MOV CANMOVE1,AL
JMP EXIT1


RIGHT1:
CMP EXPECTEDSTATE1 , 1
JNZ LEFT1
;PERFORM EQUATION CENTER-(WIDTH*320/2)+(HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (TOP RIGHT IN THE SCREEN)
;CALCULATE (HEIGHT/2) TERM
MOV AX , HEIGHT1
shr AX,1
INC AX
PUSH AX

;CALCULATE WIDTH*320/2 TERM
MOV BX,320
MOV AX,WIDTH1
shr AX,1
MUL BX

;GET THE REQUIRED POINT
MOV BX , CENTER1
SUB BX ,AX
POP AX
ADD BX,AX
MOV AX,BX
PUSH BX
MOV DX,HEIGHT1
RIGHTCOLUMN1:
MOV SI,AX
MOV CX,WIDTH1

LOOP12:
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVERIGHT1
ADD SI,320
LOOP LOOP12
POP AX
SUB AX,1
PUSH AX
DEC DX
CMP DX , 0
JNZ RIGHTCOLUMN1
POP AX
MOV AL,1
MOV CANMOVE1,AL
JMP EXIT1

CANTMOVERIGHT1:
POP AX
MOV AL,0
MOV CANMOVE1,AL
JMP EXIT1



LEFT1:
CMP EXPECTEDSTATE1,2
JNZ DOWN1

;PERFORM EQUATION CENTER+(WIDTH*320/2)-(HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (BOTTOM LEFT IN THE SCREEN)
;CALCULATE (HEIGHT/2) TERM
MOV AX , HEIGHT1
shr AX,1
INC AX
PUSH AX

;CALCULATE WIDTH*320/2 TERM
MOV BX,320
MOV AX,WIDTH1
shr AX,1
MUL BX

;GET THE REQUIRED POINT
MOV BX , CENTER1
ADD BX ,AX
POP AX
SUB BX,AX


MOV AX,BX
PUSH BX
MOV DX,HEIGHT1

LEFTCOLUMN1:
MOV SI,AX
MOV CX,WIDTH1

LOOP13: 
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVELEFT1
SUB SI,320
LOOP LOOP13
POP AX
ADD AX,1
PUSH AX
DEC DX
CMP DX , 0
JNZ LEFTCOLUMN1
POP AX
MOV AL,1
MOV CANMOVE1,AL
JMP EXIT1

CANTMOVELEFT1:
POP AX
MOV AL,0
MOV CANMOVE1,AL
JMP EXIT1

DOWN1:
;PERFORM EQUATION CENTER+(WIDTH/2)+(320*HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (TOP LEFT IN THE SCREEN)
;CALCULATE (320*HEIGHT/2) TERM
MOV BX,320
MOV AX,HEIGHT1
shr AX,1
INC AX
MUL BX
PUSH AX

;CALCULATE WIDTH/2 TERM
MOV AX , WIDTH1
shr AX,1

;GET THE REQUIRED POINT
MOV BX , CENTER1
ADD BX ,AX
POP AX
ADD BX,AX


MOV AX,BX
PUSH BX
MOV DX,HEIGHT1

DOWNROW1:
MOV SI,AX
MOV CX,WIDTH1

LOOP14:
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVEDOWN1
DEC SI
LOOP LOOP14
POP AX
SUB AX,320
PUSH AX
DEC DX
CMP DX , 0
JNZ DOWNROW1
POP AX
MOV AL,1
MOV CANMOVE1,AL
JMP EXIT1

CANTMOVEDOWN1:
POP AX
MOV AL,0
MOV CANMOVE1,AL
JMP EXIT1
EXIT1:
RET
CheckColisionCar1 ENDP
;;;;;;;;;;;;;;;;;;;;;;
;////////////////////;
;;;;;;;;;;;;;;;;;;;;;;
CheckColisionCar2 PROC FAR
CMP EXPECTEDSTATE2 , 0      
JNZ RIGHT2
;PERFORM EQUATION CENTER-(WIDTH/2)-(320*HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (TOP LEFT IN THE SCREEN)
;CALCULATE (320*HEIGHT/2) TERM
MOV BX,320          
MOV AX,HEIGHT2
shr AX,1
INC AX
MUL BX
PUSH AX

;CALCULATE WIDTH/2 TERM
MOV AX , WIDTH2
shr AX,1

;GET THE REQUIRED POINT
MOV BX , CENTER2
SUB BX ,AX
POP AX
SUB BX,AX

MOV AX,BX
PUSH BX
MOV DX,HEIGHT2 
UPROW2:
MOV SI,AX
MOV CX,WIDTH2


LOOP21:
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVEUP2   ; ->THIS PIXEL HAS COLOUR OF THE OBSTACLE SO CAR CAN'T MOVE
INC SI
LOOP LOOP21
POP AX
ADD AX,320      ; MOVE TO THE NEXT ROW
PUSH AX
DEC DX          
CMP DX , 0
JNZ UPROW2
POP AX
MOV AL,1
MOV CANMOVE2,AL
JMP EXIT2

CANTMOVEUP2:
POP AX
MOV AL,0
MOV CANMOVE2,AL
JMP EXIT2


RIGHT2:
CMP EXPECTEDSTATE2 , 1
JNZ LEFT2
;PERFORM EQUATION CENTER-(WIDTH*320/2)+(HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (TOP RIGHT IN THE SCREEN)
;CALCULATE (HEIGHT/2) TERM
MOV AX , HEIGHT2
shr AX,1
INC AX
PUSH AX

;CALCULATE WIDTH*320/2 TERM
MOV BX,320
MOV AX,WIDTH2
shr AX,1
MUL BX

;GET THE REQUIRED POINT
MOV BX , CENTER2
SUB BX ,AX
POP AX
ADD BX,AX
PUSH BX
MOV AX,BX
MOV DX,HEIGHT2
RIGHTCOLUMN2:
MOV SI,AX
MOV CX,WIDTH2

LOOP22:
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVERIGHT2
ADD SI,320
LOOP LOOP22
POP AX
SUB AX,1
PUSH AX
DEC DX
CMP DX , 0
JNZ RIGHTCOLUMN2
POP AX
MOV AL,1
MOV CANMOVE2,AL
JMP EXIT2

CANTMOVERIGHT2:
POP AX
MOV AL,0
MOV CANMOVE2,AL
JMP EXIT2



LEFT2:
CMP EXPECTEDSTATE2,2
JNZ DOWN2

;PERFORM EQUATION CENTER+(WIDTH*320/2)-(HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (BOTTOM LEFT IN THE SCREEN)
;CALCULATE (HEIGHT/2) TERM
MOV AX , HEIGHT2
shr AX,1
INC AX
PUSH AX

;CALCULATE WIDTH*320/2 TERM
MOV BX,320
MOV AX,WIDTH2
shr AX,1
MUL BX

;GET THE REQUIRED POINT
MOV BX , CENTER2
ADD BX ,AX
POP AX
SUB BX,AX

PUSH BX
MOV AX,BX
MOV DX,HEIGHT2

LEFTCOLUMN2:
MOV SI,AX
MOV CX,WIDTH2

LOOP23: 
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVELEFT2
SUB SI,320
LOOP LOOP23
POP AX
ADD AX,1
PUSH AX
DEC DX
CMP DX , 0
JNZ LEFTCOLUMN2
POP AX
MOV AL,1
MOV CANMOVE2,AL
JMP EXIT2

CANTMOVELEFT2:
POP AX
MOV AL,0
MOV CANMOVE2,AL
JMP EXIT2

DOWN2:
;PERFORM EQUATION CENTER+(WIDTH/2)+(320*HEIGHT/2) TO GET TOP LEFT POINT OF THE CAR (TOP LEFT IN THE SCREEN)
;CALCULATE (320*HEIGHT/2) TERM
MOV BX,320
MOV AX,HEIGHT2
shr AX,1
INC AX
MUL BX
PUSH AX

;CALCULATE WIDTH/2 TERM
MOV AX , WIDTH2
shr AX,1

;GET THE REQUIRED POINT
MOV BX , CENTER2
ADD BX ,AX
POP AX
ADD BX,AX

PUSH BX
MOV AX,BX
MOV DX,HEIGHT2

DOWNROW2:
MOV SI,AX
MOV CX,WIDTH2

LOOP24:
MOV AL, [ES:[SI]]
CMP AL, collisionCOLOR
JZ CANTMOVEDOWN2
DEC SI
LOOP LOOP24
POP AX
SUB AX,320
PUSH AX
DEC DX
CMP DX , 0
JNZ DOWNROW2
POP AX
MOV AL,1
MOV CANMOVE2,AL
JMP EXIT2

CANTMOVEDOWN2:
POP AX
MOV AL,0
MOV CANMOVE2,AL
JMP EXIT2
EXIT2:
RET
CheckColisionCar2 ENDP
END 
